<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="evaluationMapper">
<select id="companyEvaluationCheck" parameterType="map" resultType="com.log4h.singletontrip.evaluation.domain.EvaluationCheckVo">
	SELECT
		r.room_nm,
	    rs.reserve_no,
	    rs.reserve_checkin_date,
	    (
			SELECT
				count(*)
			FROM
				tb_company_evaluation c
			WHERE
				c.member_id = #{memberId}
			AND
				c.company_id = #{pageId}
			AND
				c.reserve_no = rs.reserve_no
	    ) as evaluationCheck
	FROM
		tb_reserve rs
	JOIN
		tb_room r
	ON
		rs.room_no = r.room_no
	WHERE
		rs.person_id = #{memberId}
	AND
		r.company_id = #{pageId}
</select>
<select id="personEvaluationCheck" parameterType="map" resultType="com.log4h.singletontrip.evaluation.domain.EvaluationCheckVo">
	SELECT
		t.trip_no,
        t.trip_title,
        t.trip_start_date,
	    (
			SELECT
				count(*)
			FROM
				tb_person_evaluation pe
			WHERE
				pe.member_id = #{memberId}
			AND
				pe.person_id = #{pageId}
			AND
				pe.trip_no = t.trip_no
	    ) as evaluationCheck
	FROM
		tb_trip t
	JOIN
		tb_group g
	ON
		t.trip_no = g.trip_no
	WHERE
		g.person_id = #{memberId}
	AND
		t.person_id = #{pageId}
</select>
<insert id="companyEvaluationAdd" parameterType="com.log4h.singletontrip.evaluation.domain.CompanyEvaluationVo">
	INSERT INTO tb_company_evaluation(
		reserve_no,
		member_id,
		company_id,
		company_evaluation_rating,
		company_evaluation_content,
		company_evaluation_reg_date
	)
	VALUES(
		#{reserveNo},
		#{memberId},
		#{companyId},
		#{companyEvaluationRating},
		#{companyEvaluationContent},
		now()
	)
</insert>
<insert id="personEvaluationAdd" parameterType="com.log4h.singletontrip.evaluation.domain.PersonEvaluationVo">
	INSERT INTO tb_person_evaluation(
		trip_no,
		member_id,
		person_id,
		person_evaluation_rating,
		person_evaluation_content,
		person_evaluation_reg_date
	)
	VALUES(
		#{tripNo},
		#{memberId},
		#{personId},
		#{personEvaluationRating},
		#{personEvaluationContent},
		now()
	)
</insert>
</mapper>