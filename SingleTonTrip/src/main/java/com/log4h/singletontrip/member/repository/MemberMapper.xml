<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberMapper">
<!-- 로그인 -->
<select id="login" parameterType="map" resultType="com.log4h.singletontrip.member.domain.LoginVo">
	SELECT 
		member_id,
		member_pw,
		member_nm,
		member_level
	FROM
		tb_member
	WHERE
		member_id = #{loginId}
	AND
		member_pw = #{loginPw}
</select>

<!-- 개인회원가입 -->
<insert id="personMemberJoin" parameterType="com.log4h.singletontrip.member.domain.PersonVo">
	INSERT INTO tb_member(
		member_id,
		member_level,
		member_pw,
		member_nm,
		member_phone,
		member_email,
		member_reg_date
		)
	VALUE(
		#{memberId},
		#{memberLevel},
		#{memberPw},
		#{memberNm},
		#{memberPhone},
		#{memberEmail},
		
		now()		
		)
</insert>

<!-- 업체회원가입 -->
<insert id="companyMemberJoin" parameterType="com.log4h.singletontrip.member.domain.CompanyVo">
	INSERT INTO tb_member(
		member_id,
		member_level,
		member_pw,
		member_nm,
		member_phone,
		member_email,
		member_reg_date
		)
	VALUE(
		#{memberId},
		#{memberLevel},
		#{memberPw},
		#{memberNm},
		#{memberPhone},
		#{memberEmail},
		
		now()		
		)
</insert>

<!-- 개인테이블에 추가 데이터 삽입 -->
<insert id="personJoin" parameterType="com.log4h.singletontrip.member.domain.PersonVo">
	INSERT INTO tb_person(
		person_id,
		person_birth,
		person_gender
		)
	VALUE(
		#{memberId},
		#{personBirth},
		#{personGender}
		)
</insert>

<!-- 업체테이블에 추가 데이터 삽입 -->
<insert id="companyJoin" parameterType="com.log4h.singletontrip.member.domain.CompanyVo">
	INSERT INTO tb_company(
		company_id,
		company_crd,
		company_type_cd,
		company_address
		)
	VALUE(
		#{memberId},
		#{companyCrd},
		#{companyTypeCd},
		#{companyAddress}
		)
</insert>

<!-- 개인회원 총 카운트 -->
<select id="personTotalCount" parameterType="Map" resultType="int">
	SELECT
		COUNT(*)
	FROM
		tb_member m
	JOIN
		tb_person p
	ON 
		m.member_id = p.person_id
	<if test="selectValue != null and selectValue !=''">
	WHERE
		${selectOption} LIKE '%${selectValue}%'
	</if>

</select>

<!-- 개인회원리스트 -->
<select id="personList" parameterType="Map" resultType="com.log4h.singletontrip.member.domain.PersonVo">
	SELECT
		m.member_id,
		m.member_nm,
		m.member_phone,
		m.member_email,
		p.person_birth,
		p.person_gender,
		a.act_state_nm
	FROM
		tb_member m
	JOIN
		tb_person p
	ON 
		m.member_id = p.person_id
	JOIN 
		tb_act_state a
	ON 
		m.act_state_cd = a.act_state_cd	
	<if test="selectValue != null and selectValue !=''">
	WHERE
		${selectOption} LIKE '%${selectValue}%'
	</if>
	ORDER BY m.member_reg_date
	DESC LIMIT #{beginRow}, #{pagePerRow}
</select>

<!-- 업체회원 총 카운트 -->
<select id="companyTotalCount" parameterType="Map" resultType="int">
	SELECT
		COUNT(*)
	FROM
		tb_member m
	JOIN
		tb_company c
	ON 
		m.member_id = c.company_id
	<if test="selectValue != null and selectValue !=''">
	WHERE
		${selectOption} LIKE '%${selectValue}%'
	</if>

</select>

<!-- 업체회원리스트 -->
<select id="companyList" parameterType="Map" resultType="com.log4h.singletontrip.member.domain.CompanyVo">
	SELECT
		m.member_id,
		m.member_nm,
		m.member_phone,
		m.member_email,
		c.company_crd,
		t.company_type_nm,
		a.act_state_nm
	FROM
		tb_member m
	JOIN
		tb_company c
	ON 
		m.member_id = c.company_id
	JOIN 
		tb_company_type t
	ON 
		c.company_type_cd = t.company_type_cd	
	JOIN 
		tb_act_state a
	ON 
		m.act_state_cd = a.act_state_cd	
	<if test="selectValue != null and selectValue !=''">
	WHERE
		${selectOption} LIKE '%${selectValue}%'
	</if>
	ORDER BY m.member_reg_date
	DESC LIMIT #{beginRow}, #{pagePerRow}
</select>

<!-- 개인회원상세보기 -->
<select id="personDetail" parameterType="String" resultType="com.log4h.singletontrip.member.domain.PersonVo">
	SELECT
		m.member_id,
		m.member_nm,
		m.member_phone,
		m.member_email,
		m.member_report_count,
		p.person_birth,
		p.person_gender,
		p.person_total_mileage,
		t.trip_state_nm,
		a.act_state_nm
	FROM
		tb_member m
	JOIN
		tb_person p
	ON 
		m.member_id = p.person_id
	JOIN 
		tb_act_state a
	ON 
		m.act_state_cd = a.act_state_cd
	JOIN
		tb_trip_state t
	ON 
		p.trip_state_cd = t.trip_state_cd
	WHERE
		member_id=#{memberId}
</select>

<!-- 업체회원상세보기 -->
<select id="companyDetail" parameterType="String" resultType="com.log4h.singletontrip.member.domain.CompanyVo">
	SELECT
		m.member_id,
		m.member_nm,
		m.member_phone,
		m.member_email,
		m.member_report_count,
		c.company_crd,
		t.company_type_nm,
		c.company_address,
		a.act_state_nm
	FROM
		tb_member m
	JOIN
		tb_company c
	ON 
		m.member_id = c.company_id
	JOIN 
		tb_company_type t
	ON 
		c.company_type_cd = t.company_type_cd	
	JOIN 
		tb_act_state a
	ON 
		m.act_state_cd = a.act_state_cd
	WHERE
		member_id=#{memberId}
</select>

<!-- 회원탈퇴처리 -->
<update id="memberDrop" parameterType="Map">
	UPDATE
		tb_member
	SET
		act_state_cd='6',
		member_drop_date=now(),
		member_drop_reason='test'
	WHERE
		member_id= #{memberId}
	AND
		member_pw= #{memberPw}
</update>

</mapper>